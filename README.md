# MDM Bot

Telegram e-commerce bot –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º —á–µ—Ä–µ–∑ MeiliSearch, –∫–æ—Ä–∑–∏–Ω–æ–π, –∏–∑–±—Ä–∞–Ω–Ω—ã–º –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–æ–≤.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Production)

### Docker Compose (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ environment
cp .env.production .env
nano .env  # –£–∫–∞–∂–∏—Ç–µ BOT_TOKEN, POSTGRES_PASSWORD, MEILI_MASTER_KEY

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker-compose ps
docker-compose logs -f bot
```

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:**
- PostgreSQL 16 (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- MeiliSearch v1.10 (–ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫)
- Bot (aiogram 3.x)
- Postgresus (–∞–¥–º–∏–Ω–∫–∞ –ë–î)

üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [DEPLOYMENT.md](DEPLOYMENT.md)

## üíª –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (–ø—Ä–æ—â–µ)

```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
cp .env.example .env
nano .env

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –õ–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f bot
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π Python

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** Python 3.10+

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv .venv
source .venv/bin/activate  # Unix
# –∏–ª–∏ .venv\Scripts\activate.ps1  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -e .

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env
cp .env.example .env
nano .env

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL –∏ MeiliSearch —á–µ—Ä–µ–∑ Docker
docker-compose up -d postgres meilisearch

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ
python main.py
```

## üì¶ –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ CSV

```bash
# –ü–æ–ª–æ–∂–∏—Ç–µ old_db_lite.csv –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ;)
# –ß–µ—Ä–µ–∑ Docker:
docker-compose exec bot uv run convert.py

# –õ–æ–∫–∞–ª—å–Ω–æ:
python convert.py
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **–ü–æ–∏—Å–∫:** –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –∞—Ä—Ç–∏–∫—É–ª—É —á–µ—Ä–µ–∑ MeiliSearch
- **–ö–∞—Ç–∞–ª–æ–≥:** –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
- **–ö–æ—Ä–∑–∏–Ω–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **–ó–∞–∫–∞–∑—ã:** –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ —Å –¥–µ—Ç–∞–ª—è–º–∏
- **–ü—Ä–æ—Ñ–∏–ª—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–µ–º, —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –∞–¥—Ä–µ—Å–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏
- **–ü–æ–º–æ—â—å:** –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Framework:** aiogram 3.x (async Telegram bot)
- **Database:** SQLAlchemy (async) + PostgreSQL/SQLite
- **Search:** MeiliSearch –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- **Config:** pydantic-settings —Å .env

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
‚îú‚îÄ‚îÄ main.py           # Bot handlers, FSM states
‚îú‚îÄ‚îÄ models.py         # SQLAlchemy models
‚îú‚îÄ‚îÄ database.py       # Database connection & setup
‚îú‚îÄ‚îÄ config.py         # Settings class
‚îú‚îÄ‚îÄ kbs.py            # Keyboard builders
‚îú‚îÄ‚îÄ utils.py          # Text formatters
‚îú‚îÄ‚îÄ convert.py        # CSV import script
‚îú‚îÄ‚îÄ docker-compose.yaml       # Production setup
‚îî‚îÄ‚îÄ DEPLOYMENT.md     # Production deployment guide
```

## üìä –°–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| Bot | - | Telegram bot (polling) |
| PostgreSQL | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| MeiliSearch | 7700 | –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ + –∞–¥–º–∏–Ω–∫–∞ |
| Postgresus | 4005 | PostgreSQL admin UI |

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose restart bot

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# –û–±–Ω–æ–≤–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
docker-compose up -d --build

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec postgres pg_dump -U postgres_dev mdm_bot_db > backup.sql
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è `POSTGRES_PASSWORD`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π `MEILI_MASTER_KEY` (–º–∏–Ω–∏–º—É–º 16 —Å–∏–º–≤–æ–ª–æ–≤)
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª—ã (—É–∂–µ –≤ .gitignore)
- –í production –∑–∞–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã PostgreSQL –∏ MeiliSearch –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [DEPLOYMENT.md](DEPLOYMENT.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- [CLAUDE.md](CLAUDE.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å Claude Code
- [PLAN.md](PLAN.md) - –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–æ MVP

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –±–∞–∑–æ–≤–∞—è (regex –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
- –ù–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MVP)
- –°–º. PLAN.md –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
