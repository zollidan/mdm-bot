# Production Setup - ะัะฐัะบะฐั ัะฒะพะดะบะฐ

## ๐ฏ ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ

ะกะพะทะดะฐะฝ ะฟะพะปะฝะพัะตะฝะฝัะน production-ัะตะถะธะผ ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั MDM Bot ัะตัะตะท Docker Compose ั ะฟะพะดะดะตัะถะบะพะน MeiliSearch.

## ๐ฆ ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั

### 1. ะะพะฝัะธะณััะฐัะธะพะฝะฝัะต ัะฐะนะปั

- **`.env.production`** - ะจะฐะฑะปะพะฝ production ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
- **`.env.example`** - ะะฑะฝะพะฒะปะตะฝ ั ะฟะพะปะฝัะผ ะฝะฐะฑะพัะพะผ ะฟะตัะตะผะตะฝะฝัั (ะฒะบะปััะฐั MeiliSearch)
- **`docker-compose.override.yml.example`** - Override ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ

### 2. ะะพะบัะผะตะฝัะฐัะธั

- **`DEPLOYMENT.md`** - ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ ะฟะพ production ัะฐะทะฒะตัััะฒะฐะฝะธั
  - ะัััััะน ััะฐัั
  - ะะพะฝัะธะณััะฐัะธั ัะตัะฒะธัะพะฒ
  - ะะพะผะฐะฝะดั ะพะฑัะปัะถะธะฒะฐะฝะธั
  - Troubleshooting
  - Backup/restore ะฟัะพัะตะดััั

- **`PRODUCTION_CHECKLIST.md`** - ะะพัะฐะณะพะฒัะน ัะตะบะปะธัั ะดะปั deployment
  - ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั
  - ะะพะฝัะธะณััะฐัะธั ะฑะตะทะพะฟะฐัะฝะพััะธ
  - ะัะพะฒะตัะบะฐ ะฟะพัะปะต ัะฐะทะฒะตัััะฒะฐะฝะธั
  - ะะตะณัะปััะฝะพะต ะพะฑัะปัะถะธะฒะฐะฝะธะต

- **`README.md`** - ะะฑะฝะพะฒะปะตะฝ ั production ะธะฝััััะบัะธัะผะธ
  - ะัััััะน ััะฐัั ะดะปั production
  - ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ
  - ะััะธัะตะบัััะฐ ะธ ัะตัะฒะธัั

- **`CLAUDE.md`** - ะะฑะฝะพะฒะปะตะฝ ั ะธะฝัะพัะผะฐัะธะตะน ะพ:
  - MeiliSearch ะธะฝัะตะณัะฐัะธะธ
  - Docker deployment
  - Production ะบะพะฝัะธะณััะฐัะธะธ
  - ะะตะทะพะฟะฐัะฝะพััะธ

### 3. ะัะฟะพะผะพะณะฐัะตะปัะฝัะต ะธะฝััััะผะตะฝัั

- **`Makefile`** - ะฃะดะพะฑะฝัะต ะบะพะผะฐะฝะดั ะดะปั ัะฟัะฐะฒะปะตะฝะธั:
  - `make dev` - ะะฐะฟััะบ ะฒ dev ัะตะถะธะผะต
  - `make prod` - Production ัะฐะทะฒะตัััะฒะฐะฝะธะต
  - `make backup` - ะกะพะทะดะฐะฝะธะต ะฑัะบะฐะฟะฐ ะะ
  - `make health` - ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะตัะฒะธัะพะฒ
  - ะ ะตัะต 25+ ะบะพะผะฐะฝะด

## ๐ง ะะทะผะตะฝะตะฝะฝัะต ัะฐะนะปั

### `docker-compose.yaml`

**ะฃะปัััะตะฝะธั ะดะปั production:**

1. **Bot ัะตัะฒะธั:**
   - ะะพะฑะฐะฒะปะตะฝั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะดะปั Docker-ัะตัะธ
   - `restart: unless-stopped` ะดะปั ะฐะฒัะพะฟะตัะตะทะฐะฟััะบะฐ
   - Resource limits: 1 CPU, 512MB RAM

2. **MeiliSearch:**
   - ะะตะถะธะผ ะฟะตัะตะบะปััะฐะตััั ัะตัะตะท `MEILI_ENV` (development/production)
   - ะัะบะปััะตะฝะฐ ะฐะฝะฐะปะธัะธะบะฐ (`MEILI_NO_ANALYTICS=true`)
   - Resource limits: 0.5 CPU, 1GB RAM
   - ะฃะปัััะตะฝั health checks

3. **ะะฑัะตะต:**
   - ะัะต ัะตัะฒะธัั ั `restart: unless-stopped`
   - Health checks ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ะทะฐะฟััะบะฐ
   - Resource limits ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ

### `config.py`

- ะะพะฑะฐะฒะปะตะฝะพ ะฟะพะปะต `MEILI_ENV` ะฒ settings class

### `.gitignore`

- ะะพะฑะฐะฒะปะตะฝั:
  - `.env.local`
  - `docker-compose.override.yml`
  - `postgresus-data/`
  - `backups/`

## ๐ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั

### ะัััััะน Production Deploy

```bash
# 1. ะะฐัััะพะธัั ะพะบััะถะตะฝะธะต
cp .env.production .env
nano .env  # ะะฐะฟะพะปะฝะธัั BOT_TOKEN, ะฟะฐัะพะปะธ, ะบะปััะธ

# 2. ะะฐะฟัััะธัั (ัะตัะตะท make)
make prod

# ะะปะธ ะฝะฐะฟััะผัั
docker-compose up -d
```

### Development Setup

```bash
# 1. ะะฐัััะพะธัั dev ะพะบััะถะตะฝะธะต
make dev

# 2. ะะพัะผะพััะตัั ะปะพะณะธ
make logs-bot
```

## ๐ ะัะธัะธัะตัะบะธะต ะฟะตัะตะผะตะฝะฝัะต ะดะปั Production

ะะฑัะทะฐัะตะปัะฝะพ ะฝะฐัััะพะธัั:

1. **`BOT_TOKEN`** - ะขะพะบะตะฝ ะพั @BotFather
2. **`POSTGRES_PASSWORD`** - ะกะธะปัะฝัะน ะฟะฐัะพะปั (ะณะตะฝะตัะธัะพะฒะฐัั: `openssl rand -base64 32`)
3. **`MEILI_MASTER_KEY`** - ะะธะฝะธะผัะผ 16 ัะธะผะฒะพะปะพะฒ (ะณะตะฝะตัะธัะพะฒะฐัั: `openssl rand -base64 24`)

## ๐ ะััะธัะตะบัััะฐ Production

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          Docker Compose Stack            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                          โ
โ  โโโโโโโโโโโโ      โโโโโโโโโโโโโโโโ     โ
โ  โ   Bot    โโโโโโโถโ  PostgreSQL  โ     โ
โ  โ (aiogram)โ      โ   (port 5432)โ     โ
โ  โโโโโโฌโโโโโโ      โโโโโโโโโโโโโโโโ     โ
โ       โ                                  โ
โ       โ            โโโโโโโโโโโโโโโโ     โ
โ       โโโโโโโโโโโโโถโ MeiliSearch  โ     โ
โ                    โ   (port 7700)โ     โ
โ                    โโโโโโโโโโโโโโโโ     โ
โ                                          โ
โ                    โโโโโโโโโโโโโโโโ     โ
โ                    โ  Postgresus  โ     โ
โ                    โ   (port 4005)โ     โ
โ                    โโโโโโโโโโโโโโโโ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะฒัะพะผะฐัะธัะตัะบะธะต health checks
- ะะฐะฒะธัะธะผะพััะธ ะผะตะถะดั ัะตัะฒะธัะฐะผะธ
- Persistent volumes ะดะปั ะดะฐะฝะฝัั
- Resource limits ะดะปั ััะฐะฑะธะปัะฝะพััะธ

## ๐ Monitoring & Maintenance

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั

```bash
make health        # ะัะพะฒะตัะธัั ะฒัะต ัะตัะฒะธัั
make status        # ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
make stats         # ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ
```

### ะะพะณะธ

```bash
make logs          # ะัะต ะปะพะณะธ
make logs-bot      # ะขะพะปัะบะพ ะฑะพั
make logs-db       # ะะฐะทะฐ ะดะฐะฝะฝัั
make logs-search   # MeiliSearch
```

### Backup & Restore

```bash
# ะกะพะทะดะฐัั ะฑัะบะฐะฟ
make backup

# ะะพัััะฐะฝะพะฒะธัั ะธะท ะฑัะบะฐะฟะฐ
make restore FILE=backups/backup-20231225-120000.sql.gz
```

### ะะฑะฝะพะฒะปะตะฝะธะต

```bash
make update        # ะะฑะฝะพะฒะธัั ะฒัะต ะพะฑัะฐะทั ะธ ะฟะตัะตะทะฐะฟัััะธัั
```

## โก ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### Resource Limits (Production)

| ะกะตัะฒะธั | CPU | RAM | ะะฐะทะฝะฐัะตะฝะธะต |
|--------|-----|-----|-----------|
| Bot | 1.0 | 512MB | Telegram bot logic |
| PostgreSQL | 1.0 | 4GB | ะัะฝะพะฒะฝะฐั ะะ |
| MeiliSearch | 0.5 | 1GB | ะะพะธัะบะพะฒัะน ะธะฝะดะตะบั |

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะดะปั ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั

**ะะฐะปะฐั ะฝะฐะณััะทะบะฐ (<1000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน):**
- ะขะตะบััะฐั ะบะพะฝัะธะณััะฐัะธั ะดะพััะฐัะพัะฝะฐ
- ะะธะฝะธะผะฐะปัะฝัะน ัะตัะฒะตั: 2 CPU, 6GB RAM

**ะกัะตะดะฝัั ะฝะฐะณััะทะบะฐ (1000-10000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน):**
- ะฃะฒะตะปะธัะธัั PostgreSQL ะดะพ 2 CPU, 8GB RAM
- ะฃะฒะตะปะธัะธัั MeiliSearch ะดะพ 1 CPU, 2GB RAM
- ะกะตัะฒะตั: 4 CPU, 12GB RAM

**ะััะพะบะฐั ะฝะฐะณััะทะบะฐ (>10000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน):**
- ะัะฟะพะปัะทะพะฒะฐัั managed PostgreSQL (AWS RDS, etc.)
- ะัะฝะตััะธ MeiliSearch ะฝะฐ ะพัะดะตะปัะฝัะน ัะตัะฒะตั
- ะะพะฑะฐะฒะธัั Redis ะดะปั ะบััะธัะพะฒะฐะฝะธั
- Load balancer ะดะปั ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั bot ะธะฝััะฐะฝัะพะฒ

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะงะตะบ-ะปะธัั ะฑะตะทะพะฟะฐัะฝะพััะธ

- โ ะกะธะปัะฝัะต ะฟะฐัะพะปะธ ะดะปั ะะ ะธ MeiliSearch
- โ `.env` ะฒ .gitignore (ัะตะบัะตัั ะฝะต ะบะพะผะผะธััััั)
- โ Resource limits (ะทะฐัะธัะฐ ะพั memory leaks)
- โ Health checks (ะฐะฒัะพะผะฐัะธัะตัะบะธะน restart ะฟัะธ ัะฑะพัั)
- โ๏ธ ะ production ะทะฐะบัััั ะฟะพััั 5432, 7700 ะพั ะฒะฝะตัะฝะตะณะพ ะดะพัััะฟะฐ
- โ๏ธ ะะฐัััะพะธัั ัะฐะนัะฒะพะป (ufw/iptables)
- โ๏ธ ะัะฟะพะปัะทะพะฒะฐัั SSL ะดะปั ะฒะฝะตัะฝะธั ัะพะตะดะธะฝะตะฝะธะน

### ะะตะบะพะผะตะฝะดะฐัะธะธ

1. **ะะต ะพัะบััะฒะฐะนัะต ะฟะพััั ะะ ะธ MeiliSearch ะฝะฐััะถั** - ะทะฐะบะพะผะผะตะฝัะธััะนัะต ะฒ docker-compose.yaml:
```yaml
# ports:
#   - "5432:5432"
```

2. **ะัะฟะพะปัะทัะนัะต SSH ะบะปััะธ** ะดะปั ะดะพัััะฟะฐ ะบ ัะตัะฒะตัั

3. **ะะฐัััะพะนัะต ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะฑัะบะฐะฟั** ัะตัะตะท cron (ัะผ. DEPLOYMENT.md)

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [DEPLOYMENT.md](DEPLOYMENT.md) - ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ
- [PRODUCTION_CHECKLIST.md](PRODUCTION_CHECKLIST.md) - ะงะตะบะปะธัั ัะฐะทะฒะตัััะฒะฐะฝะธั
- [README.md](README.md) - ะะฑัะฐั ะธะฝัะพัะผะฐัะธั ะพ ะฟัะพะตะบัะต
- [CLAUDE.md](CLAUDE.md) - ะะฝััััะบัะธะธ ะดะปั ัะฐะทัะฐะฑะพัะบะธ

## ๐ ะงัะพ ะดะฐะปััะต?

1. **ะัะพัะธัะฐัั** [DEPLOYMENT.md](DEPLOYMENT.md) ะดะปั ะดะตัะฐะปัะฝะพะณะพ ะฟะพะฝะธะผะฐะฝะธั
2. **ะัะฟะพะปัะทะพะฒะฐัั** [PRODUCTION_CHECKLIST.md](PRODUCTION_CHECKLIST.md) ะฟัะธ ัะฐะทะฒะตัััะฒะฐะฝะธะธ
3. **ะะฐัััะพะธัั** ะผะพะฝะธัะพัะธะฝะณ ะธ ะฐะปะตััั (ะพะฟัะธะพะฝะฐะปัะฝะพ: Prometheus + Grafana)
4. **ะะฐะฟะปะฐะฝะธัะพะฒะฐัั** ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะฑัะบะฐะฟั
5. **ะัะพัะตััะธัะพะฒะฐัั** ะฟัะพัะตะดััั ะฒะพัััะฐะฝะพะฒะปะตะฝะธั

## ๐ก ะกะพะฒะตัั

- ะัะฟะพะปัะทัะนัะต `make help` ะดะปั ัะฟะธัะบะฐ ะฒัะตั ะดะพัััะฟะฝัั ะบะพะผะฐะฝะด
- ะะตะณัะปััะฝะพ ะฟัะพะฒะตััะนัะต ะปะพะณะธ: `make logs-bot`
- ะะตะปะฐะนัะต ะฑัะบะฐะฟั ะฟะตัะตะด ะพะฑะฝะพะฒะปะตะฝะธัะผะธ: `make backup && make update`
- ะขะตััะธััะนัะต ะฝะฐ staging ะพะบััะถะตะฝะธะธ ะฟะตัะตะด production
- ะะพะบัะผะตะฝัะธััะนัะต ะฒัะต ะธะทะผะตะฝะตะฝะธั ะบะพะฝัะธะณััะฐัะธะธ

## โ ะะพะฟัะพัั ะธ ะฟะพะดะดะตัะถะบะฐ

ะัะธ ะฟัะพะฑะปะตะผะฐั:
1. ะัะพะฒะตัััะต [DEPLOYMENT.md](DEPLOYMENT.md) ัะฐะทะดะตะป Troubleshooting
2. ะะพัะผะพััะธัะต ะปะพะณะธ: `make logs`
3. ะัะพะฒะตัััะต health: `make health`
4. ะัะบัะพะนัะต issue ะฒ ัะตะฟะพะทะธัะพัะธะธ

---

**ะะตััะธั:** 1.0
**ะะฐัะฐ:** 2025-12-22
**ะกัะฐััั:** โ Production Ready
