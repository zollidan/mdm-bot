<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>mdm bot ‚Äî —Ç–æ–≤–∞—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background-color: #fffef9;
        -webkit-tap-highlight-color: transparent;
      }

      .neo-shadow {
        box-shadow: 4px 4px 0px 0px rgba(0, 0, 0, 1);
      }

      .neo-shadow-sm {
        box-shadow: 2px 2px 0px 0px rgba(0, 0, 0, 1);
      }

      .neo-press:active {
        transform: translate(2px, 2px);
        box-shadow: none;
      }

      .image-container {
        position: relative;
        width: 100%;
        aspect-ratio: 1;
        overflow: hidden;
      }

      .zoom-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .zoom-image:active {
        transform: scale(1.5);
      }
    </style>
  </head>
  <body class="text-black antialiased">
    <!-- Header -->
    <header class="sticky top-0 z-50 p-4">
      <nav
        class="flex items-center justify-between bg-white border-2 border-black rounded-2xl p-4 neo-shadow"
      >
        <a href="/products" class="flex items-center gap-2 neo-press">
          <div
            class="w-8 h-8 bg-[#FCD34D] border-2 border-black rounded-lg flex items-center justify-center font-extrabold text-sm"
          >
            ‚Üê
          </div>
          <h1 class="text-xl font-extrabold tracking-tight">–Ω–∞–∑–∞–¥</h1>
        </a>
        <div
          id="cart-counter"
          class="bg-black text-white px-3 py-1 rounded-full text-xs font-bold"
        >
          0 –¢–û–í–ê–†–û–í
        </div>
      </nav>
    </header>

    <main class="p-4 space-y-6" id="product-container">
      <!-- Loading State -->
      <div class="animate-pulse space-y-6">
        <div
          class="w-full aspect-square bg-white border-2 border-black rounded-3xl neo-shadow flex items-center justify-center"
        >
          <p class="font-extrabold text-xl opacity-20 italic">–∑–∞–≥—Ä—É–∂–∞–µ–º...</p>
        </div>
        <div class="h-32 bg-white border-2 border-black rounded-2xl neo-shadow"></div>
      </div>
    </main>

    <script>
      const productId = window.location.pathname.split("/").pop();
      let cartCount = 0;

      async function loadProductDetails() {
        const container = document.getElementById("product-container");

        try {
          const response = await fetch(`/api/products/${productId}`);

          if (!response.ok) {
            throw new Error("Product not found");
          }

          const product = await response.json();
          renderProduct(product);
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
          container.innerHTML = `
            <div class="bg-red-100 border-2 border-black rounded-2xl p-8 text-center neo-shadow space-y-4">
              <p class="text-4xl">üòû</p>
              <p class="font-bold text-red-600 text-lg">–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
              <a href="/products" class="inline-block py-3 px-6 bg-white border-2 border-black rounded-xl font-extrabold neo-press">
                –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
              </a>
            </div>
          `;
        }
      }

      function renderProduct(product) {
        const container = document.getElementById("product-container");

        container.innerHTML = `
          <!-- Product Image -->
          <div class="image-container bg-white border-2 border-black rounded-3xl neo-shadow overflow-hidden">
            ${
              product.image
                ? `<img src="${product.image}" alt="${product.name}" class="zoom-image">`
                : `<div class="w-full h-full flex items-center justify-center bg-gray-50">
                     <span class="text-8xl">üì¶</span>
                   </div>`
            }
          </div>

          <!-- Product Info Card -->
          <div class="bg-white border-2 border-black rounded-2xl p-6 neo-shadow space-y-6">
            <!-- Vendor Code Badge -->
            ${
              product.vendor_code
                ? `<div class="inline-block px-3 py-1 bg-gray-100 border-2 border-black rounded-lg text-xs font-black uppercase">
                     art: ${product.vendor_code}
                   </div>`
                : ""
            }

            <!-- Product Name -->
            <h2 class="text-3xl font-extrabold leading-tight">${product.name}</h2>

            <!-- Description -->
            ${
              product.description
                ? `<div class="pt-4 border-t-2 border-gray-100">
                     <p class="text-sm font-bold text-gray-600 uppercase tracking-wide mb-2">–æ–ø–∏—Å–∞–Ω–∏–µ</p>
                     <p class="text-base leading-relaxed font-medium">${product.description}</p>
                   </div>`
                : ""
            }

            <!-- Price & Actions -->
            <div class="pt-4 border-t-2 border-gray-100 space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-gray-500 uppercase">—Ü–µ–Ω–∞</span>
                <span class="text-4xl font-black">${product.price.toLocaleString()} ‚ÇΩ</span>
              </div>

              <!-- Quantity Selector -->
              <div class="flex items-center gap-3">
                <button
                  onclick="changeQuantity(-1)"
                  class="w-12 h-12 bg-white border-2 border-black rounded-xl flex items-center justify-center font-black text-xl neo-shadow-sm neo-press"
                >
                  ‚àí
                </button>
                <div class="flex-1 text-center">
                  <span id="quantity" class="text-2xl font-black">1</span>
                  <span class="text-sm font-bold text-gray-500 ml-1">—à—Ç</span>
                </div>
                <button
                  onclick="changeQuantity(1)"
                  class="w-12 h-12 bg-white border-2 border-black rounded-xl flex items-center justify-center font-black text-xl neo-shadow-sm neo-press"
                >
                  +
                </button>
              </div>

              <!-- Add to Cart Button -->
              <button
                onclick="addToCart()"
                class="w-full py-4 bg-[#FCD34D] border-2 border-black rounded-2xl font-extrabold text-lg uppercase neo-shadow neo-press"
              >
                –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
              </button>

              <!-- Buy Now Button -->
              <button
                onclick="buyNow()"
                class="w-full py-4 bg-black text-white border-2 border-black rounded-2xl font-extrabold text-lg uppercase neo-shadow neo-press"
              >
                –∫—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å ‚Üí
              </button>
            </div>
          </div>

          <!-- Additional Info -->
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-white border-2 border-black rounded-2xl p-4 neo-shadow">
              <p class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2">
                –¥–æ—Å—Ç–∞–≤–∫–∞
              </p>
              <p class="text-lg font-black">–ë–ï–°–ü–õ–ê–¢–ù–û</p>
            </div>
            <div class="bg-white border-2 border-black rounded-2xl p-4 neo-shadow">
              <p class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2">
                –≥–∞—Ä–∞–Ω—Ç–∏—è
              </p>
              <p class="text-lg font-black">1 –ì–û–î</p>
            </div>
          </div>
        `;
      }

      let quantity = 1;

      function changeQuantity(delta) {
        quantity = Math.max(1, quantity + delta);
        document.getElementById("quantity").innerText = quantity;

        // Haptic feedback for Telegram
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.HapticFeedback.impactOccurred("light");
        }
      }

      function addToCart() {
        cartCount += quantity;
        document.getElementById("cart-counter").innerText = `${cartCount} –¢–û–í–ê–†–û–í`;

        // Visual feedback
        const btn = event.target;
        const originalText = btn.innerText;
        btn.innerText = "‚úì –î–û–ë–ê–í–õ–ï–ù–û";
        btn.classList.add("bg-green-400");

        setTimeout(() => {
          btn.innerText = originalText;
          btn.classList.remove("bg-green-400");
        }, 1500);

        // Haptic feedback
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.HapticFeedback.notificationOccurred("success");
        }

        // Reset quantity
        quantity = 1;
        document.getElementById("quantity").innerText = quantity;
      }

      function buyNow() {
        // Placeholder for buy now functionality
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.HapticFeedback.impactOccurred("heavy");
          window.Telegram.WebApp.showAlert("–§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π –ø–æ–∫—É–ø–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!");
        } else {
          alert("–§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π –ø–æ–∫—É–ø–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!");
        }
      }

      window.onload = () => loadProductDetails();
    </script>
  </body>
</html>
